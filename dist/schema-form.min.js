!function(e,r){"function"==typeof define&&define.amd?define(["angular"],r):r(angular)}(this,function(e){var r=["ObjectPath"];try{e.module("ngSanitize"),r.push("ngSanitize")}catch(t){}try{e.module("ui.sortable"),r.push("ui.sortable")}catch(t){}try{e.module("angularSpectrumColorpicker"),r.push("angularSpectrumColorpicker")}catch(t){}e.module("schemaForm",r)}),function(e,r){"function"==typeof define&&define.amd?define(["angular","angular-schema-form/module","ObjectPath"],r):r(angular)}(this,function(e){e.module("schemaForm").provider("sfPath",["ObjectPathProvider",function(r){var t={parse:r.parse};t.stringify=1===e.version.major&&e.version.minor<3?function(e){return Array.isArray(e)?e.join("."):e.toString()}:r.stringify,t.normalize=function(e,r){return t.stringify(Array.isArray(e)?e:t.parse(e),r)},this.parse=t.parse,this.stringify=t.stringify,this.normalize=t.normalize,this.$get=function(){return t}}])}),function(e,r){"function"==typeof define&&define.amd?define(["angular","angular-schema-form/module","angular-schema-form/sfPath"],r):r(angular)}(this,function(e){e.module("schemaForm").factory("sfSelect",["sfPath",function(e){var r=/^\d+$/;return function(t,n,i){n||(n=this);var a="string"==typeof t?e.parse(t):t;if("undefined"!=typeof i&&1===a.length)return n[a[0]]=i,n;"undefined"!=typeof i&&"undefined"==typeof n[a[0]]&&(n[a[0]]=a.length>2&&r.test(a[1])?[]:{});for(var o=n[a[0]],u=1;u<a.length;u++){if(""===a[u])return void 0;if("undefined"!=typeof i){if(u===a.length-1)return o[a[u]]=i,i;var s=o[a[u]];("undefined"==typeof s||null===s)&&(s=r.test(a[u+1])?[]:{},o[a[u]]=s),o=s}else o&&(o=o[a[u]])}return o}}])}),function(e,r){"function"==typeof define&&define.amd?define(["angular","angular-schema-form/module","angular-schema-form/sfPath"],r):r(angular)}(this,function(e){e.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(r,t){var n="",i={},a=function(e,r){"sfDecorator"===e&&(e=n);for(var t=i[e],a=t.rules,o=0;o<a.length;o++){var u=a[o](r);if(u)return u}return t.mappings[r.type]?t.mappings[r.type]:t.mappings["default"]},o=function(n){r.directive(n,["$parse","$compile","$http","$templateCache",function(r,i,o,u){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(r,s,f,c){var l=r.$watch(f.form,function(e){if(e){r.form=e;var f=a(n,e);o.get(f,{cache:u}).then(function(n){var a=e.key?t.stringify(e.key).replace(/"/g,"&quot;"):"",o=n.data.replace(/\$\$value\$\$/g,"model"+("["!==a[0]?".":"")+a);s.html(o),i(s.contents())(r)}),l()}});r.showTitle=function(){return r.form&&r.form.notitle!==!0&&r.form.title},r.listToCheckboxValues=function(r){var t={};return e.forEach(r,function(e){t[e]=!0}),t},r.checkboxValuesToList=function(r){var t=[];return e.forEach(r,function(e,r){e&&t.push(r)}),t},r.buttonClick=function(t,n){e.isFunction(n.onClick)?n.onClick(t,n):e.isString(n.onClick)&&(c?c.evalInParentScope(n.onClick,{$event:t,form:n}):r.$eval(n.onClick,{$event:t,form:n}))},r.evalExpr=function(e,t){return c?c.evalInParentScope(e,t):r.$eval(e,t)},r.evalInScope=function(e,t){return e?r.$eval(e,t):void 0},r.errorMessage=function(t){return r.form.validationMessage?t?e.isString(r.form.validationMessage)?r.form.validationMessage:r.form.validationMessage[t.code]||r.form.validationMessage["default"]:r.form.validationMessage.required||r.form.validationMessage["default"]||r.form.validationMessage:t?t.message:"Required"}}}}])},u=function(t,n,i){i=e.isDefined(i)?i:!1,r.directive("sf"+e.uppercase(t[0])+t.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:i,template:'<sf-decorator form="form"></sf-decorator>',link:function(r,n,i){var a={items:"c",titleMap:"c",schema:"c"},o={type:t},u=!0;e.forEach(i,function(t,n){if("$"!==n[0]&&0!==n.indexOf("ng")&&"sfField"!==n){var s=function(t){e.isDefined(t)&&t!==o[n]&&(o[n]=t,u&&o.type&&(o.key||e.isUndefined(i.key))&&(r.form=o,u=!1))};"model"===n?r.$watch(t,function(e){e&&r.model!==e&&(r.model=e)}):"c"===a[n]?r.$watchCollection(t,s):i.$observe(n,s)}})}}})};this.createDecorator=function(e,r,t){i[e]={mappings:r||{},rules:t||[]},i[n]||(n=e),o(e)},this.createDirective=u,this.createDirectives=function(r){e.forEach(r,function(e,r){u(r,e)})},this.directive=function(e){return e=e||n,i[e]},this.addMapping=function(e,r,t){i[e]&&(i[e].mappings[r]=t)},this.$get=function(){return{directive:function(e){return i[e]},defaultDecorator:n}},o("sfDecorator")}])}),function(){"function"==typeof define&&define.amd&&define(["angular","angular-schema-form/module","angular-schema-form/sfPath"])}(this,function(e){e.module("schemaForm").provider("schemaForm",["sfPathProvider",function(r){var t=function(e){var r=[];return e.forEach(function(e){r.push({name:e,value:e})}),r},n=function(r,t){if(!e.isArray(r)){var n=[];return t?e.forEach(t,function(e){n.push({name:r[e],value:e})}):e.forEach(r,function(e,r){n.push({name:e,value:r})}),n}return r},i=function(e,r,t){var n=p[r.type];if(n)for(var i,a=0;a<n.length;a++)if(i=n[a](e,r,t))return i},a=function(r,t,i){i=i||{};var a=i.global&&i.global.formDefaults?e.copy(i.global.formDefaults):{};return a.title=i.global&&i.global.supressPropertyTitles===!0?t.title:t.title||r,t.description&&(a.description=t.description),(i.required===!0||t.required===!0)&&(a.required=!0),t.maxLength&&(a.maxlength=t.maxLength),t.minLength&&(a.minlength=t.maxLength),(t.readOnly||t.readonly)&&(a.readonly=!0),t.minimum&&(a.minimum=t.minimum+(t.exclusiveMinimum?1:0)),t.maximum&&(a.maximum=t.maximum-(t.exclusiveMaximum?1:0)),t.validationMessage&&(a.validationMessage=t.validationMessage),t.enumNames&&(a.titleMap=n(t.enumNames,t.enum)),a.schema=t,a.ngModelOptions=a.ngModelOptions||{},a},o=function(e,t,n){if("string"===t.type&&!t.enum){var i=a(e,t,n);return i.key=n.path,i.type="text",n.lookup[r.stringify(n.path)]=i,i}},u=function(e,t,n){if("number"===t.type){var i=a(e,t,n);return i.key=n.path,i.type="number",n.lookup[r.stringify(n.path)]=i,i}},s=function(e,t,n){if("integer"===t.type){var i=a(e,t,n);return i.key=n.path,i.type="number",n.lookup[r.stringify(n.path)]=i,i}},f=function(e,t,n){if("boolean"===t.type){var i=a(e,t,n);return i.key=n.path,i.type="checkbox",n.lookup[r.stringify(n.path)]=i,i}},c=function(e,n,i){if("string"===n.type&&n.enum){var o=a(e,n,i);return o.key=i.path,o.type="select",o.titleMap||(o.titleMap=t(n.enum)),i.lookup[r.stringify(i.path)]=o,o}},l=function(e,n,i){if("array"===n.type&&n.items&&n.items.enum){var o=a(e,n,i);return o.key=i.path,o.type="checkboxes",o.titleMap||(o.titleMap=t(n.items.enum)),i.lookup[r.stringify(i.path)]=o,o}},m=function(t,n,o){if("object"===n.type){var u=a(t,n,o);return u.type="fieldset",u.items=[],o.lookup[r.stringify(o.path)]=u,e.forEach(n.properties,function(e,t){var a=o.path.slice();if(a.push(t),o.ignore[r.stringify(a)]!==!0){var s=n.required&&-1!==n.required.indexOf(t),f=i(t,e,{path:a,required:s||!1,lookup:o.lookup,ignore:o.ignore});f&&u.items.push(f)}}),u}},d=function(e,t,n){if("array"===t.type){var o=a(e,t,n);o.type="array",o.key=n.path,n.lookup[r.stringify(n.path)]=o;var u=t.required&&-1!==t.required.indexOf(n.path(n.path.length-1)),s=n.path.slice();return s.push(""),o.items=[i(e,t.items,{path:s,required:u||!1,lookup:n.lookup,ignore:n.ignore})],o}},p={string:[c,o],object:[m],number:[u],integer:[s],"boolean":[f],array:[l,d]},h=function(e){return e};this.defaults=p,this.stdFormObj=a,this.defaultFormDefinition=i,this.postProcess=function(e){h=e},this.appendRule=function(e,r){p[e]||(p[e]=[]),p[e].push(r)},this.prependRule=function(e,r){p[e]||(p[e]=[]),p[e].unshift(r)},this.createStandardForm=a,this.$get=function(){var t={};return t.merge=function(i,a,o,u){a=a||["*"],u=u||{};var s=t.defaults(i,o,u),f=a.indexOf("*");if(-1!==f)return a=a.slice(0,f).concat(s.form).concat(a.slice(f+1));var c=s.lookup;return h(a.map(function(a){if("string"==typeof a&&(a={key:a}),a.key&&"string"==typeof a.key&&(a.key=r.parse(a.key)),a.titleMap&&(a.titleMap=n(a.titleMap)),a.itemForm){a.items=[];var u=r.stringify(a.key),s=c[u];e.forEach(s.items,function(r){var t=e.copy(a.itemForm);t.key=r.key,a.items.push(t)})}if(a.items&&(a.items=t.merge(i,a.items,o)),a.tabs&&e.forEach(a.tabs,function(e){e.items=t.merge(i,e.items,o)}),a.key){var u=r.stringify(a.key);c[u]&&(a=e.extend(c[u],a))}return"checkbox"===a.type&&e.isUndefined(a.schema["default"])&&(a.schema["default"]=!1),a}))},t.defaults=function(r,t,n){var a=[],o={};if(t=t||{},n=n||{},"object"!==r.type)throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return e.forEach(r.properties,function(e,u){if(t[u]!==!0){var s=r.required&&-1!==r.required.indexOf(u),f=i(u,e,{path:[u],lookup:o,ignore:t,required:s,global:n});f&&a.push(f)}}),{form:a,lookup:o}},t.traverseSchema=function(r,t,n,i){i=e.isDefined(i)?i:!0,n=n||[];var a=function(r,t,n){if(t(r,n),e.forEach(r.properties,function(e,r){var i=n.slice();i.push(r),a(e,t,i)}),!i&&r.items){var o=n.slice();o.push(""),a(r.items,t,o)}};a(r,t,n||[])},t.traverseForm=function(r,n){n(r),e.forEach(r.items,function(e){t.traverseForm(e,n)}),r.tabs&&e.forEach(r.tabs,function(r){e.forEach(r.items,function(e){t.traverseForm(e,n)})})},t}}])}),function(e,r){"function"==typeof define&&define.amd?define(["angular","tv4","angular-schema-form/module"],r):r(angular,tv4)}(this,function(e,r){e.module("schemaForm").factory("sfValidator",[function(){var t={};return t.validate=function(t,n){var i=t.schema;if(!i)return n;"integer"===i.type?n=parseInt(n,10):"number"===i.type?n=parseFloat(n,10):"boolean"===i.type&&"string"==typeof n&&("true"===n?n=!0:"false"===n&&(n=!1));var a={type:"object",properties:{}},o=t.key[t.key.length-1];a.properties[o]=i,t.required&&(a.required=[o]);var u={};return e.isDefined(n)&&(u[o]=n),r.validateResult(u,a)},t}])}),angular.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator",function(e,r,t){var n=function(e){return function(r){r.key&&(r.key[r.key.indexOf("")]=e)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(i,a,o,u){var s={},f=i.$watch(o.sfArray,function(a){var o=e(a.key,i.model);if(angular.isUndefined(o)&&(o=[],e(a.key,i.model,o)),i.modelArray=o,a.items){var c=a.items[0];a.items.length>1&&(c={type:"section",items:a.items})}if(i.copyWithIndex=function(e){if(!s[e]&&c){var t=angular.copy(c);t.arrayIndex=e,r.traverseForm(t,n(e)),s[e]=t}return s[e]},i.appendToArray=function(){var t=o.length,n=i.copyWithIndex(t);if(r.traverseForm(n,function(r){r.key&&angular.isDefined(r.default)&&e(r.key,i.model,r.default)}),t===o.length){var u,s=e("schema.items.type",a);"object"===s?u={}:"array"===s&&(u=[]),o.push(u)}return i.validateArray&&i.validateArray(),o},i.deleteFromArray=function(e){return o.splice(e,1),i.validateArray&&i.validateArray(),o},a.titleMap||a.startEmpty===!0||0!==o.length||i.appendToArray(),a.titleMap&&a.titleMap.length>0){i.titleMapValues=[];var l=function(e){i.titleMapValues=[],e=e||[],a.titleMap.forEach(function(r){i.titleMapValues.push(-1!==e.indexOf(r.value))})};l(i.modelArray),i.$watchCollection("modelArray",l),i.$watchCollection("titleMapValues",function(e){if(e){for(var r=i.modelArray;r.length>0;)r.shift();a.titleMap.forEach(function(t,n){e[n]&&r.push(t.value)})}})}if(u){var m;i.validateArray=function(){var e=t.validate(a,i.modelArray.length>0?i.modelArray:void 0);e.valid!==!1||!e.error||""!==e.error.dataPath&&e.error.dataPath!=="/"+a.key[a.key.length-1]?u.$setValidity("schema",!0):(u.$setViewValue(i.modelArray),m=e.error,u.$setValidity("schema",!1))},i.$on("schemaFormValidate",i.validateArray),i.hasSuccess=function(){return u.$valid&&!u.$pristine},i.hasError=function(){return u.$invalid},i.schemaError=function(){return m}}f()})}}}]),angular.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(e,r,t,n){var i=e.$eval(t.sfChanged);i&&i.onChange&&n.$viewChangeListeners.push(function(){angular.isFunction(i.onChange)?i.onChange(n.$modelValue,i):e.evalExpr(i.onChange,{modelValue:n.$modelValue,form:i})})}}}),angular.module("schemaForm").directive("sfSchema",["$compile","schemaForm","schemaFormDecorators","sfSelect",function(e,r,t,n){var i=/[A-Z]/g,a=function(e,r){return r=r||"_",e.replace(i,function(e,t){return(t?r:"")+e.toLowerCase()})};return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions"},controller:["$scope",function(e){this.evalInParentScope=function(r,t){return e.$parent.$eval(r,t)}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(i,o,u,s,f){i.formCtrl=s;var c={};f(i,function(e){if(e.addClass("schema-form-ignore"),o.prepend(e),o[0].querySelectorAll){var r=o[0].querySelectorAll("[ng-model]");if(r)for(var t=0;t<r.length;t++){var n=r[t].getAttribute("ng-model");c[n.substring(n.indexOf(".")+1)]=!0}}});var l={};i.$watch(function(){var s=i.schema,f=i.initialForm||["*"];if(f&&s&&s.type&&(l.form!==f||l.schema!==s)&&Object.keys(s.properties).length>0){l.schema=s,l.form=f;var m=r.merge(s,f,c,i.options),d=document.createDocumentFragment();i.schemaForm={form:m,schema:s},angular.forEach(m,function(e,r){var n=document.createElement(u.sfDecoratorName||a(t.defaultDecorator,"-"));n.setAttribute("form","schemaForm.form["+r+"]"),d.appendChild(n)}),o.children(":not(.schema-form-ignore)").remove(),o[0].appendChild(d),e(o.children())(i),r.traverseSchema(s,function(e,r){if(angular.isDefined(e["default"])){var t=n(r,i.model);angular.isUndefined(t)&&n(r,i.model,e["default"])}})}})}}}]),angular.module("schemaForm").directive("schemaValidate",["sfValidator",function(e){return{restrict:"A",scope:!1,require:"ngModel",link:function(r,t,n,i){r.ngModel=i;var a=null,o=r.$eval(n.schemaValidate),u=function(t){if(o||(o=r.$eval(n.schemaValidate)),!o)return t;if(angular.isDefined(n.ngRequired)&&angular.isUndefined(t))return void 0;""===t&&(t=void 0);var u=e.validate(o,t);return u.valid?(i.$setValidity("schema",!0),t):(i.$setValidity("schema",!1),void(a=u.error))};i.$parsers.unshift(u),r.$on("schemaFormValidate",function(){i.$commitViewValue?i.$commitViewValue(!0):i.$setViewValue(i.$viewValue)}),r.hasSuccess=function(){return i.$valid&&(!i.$pristine||!i.$isEmpty(i.$modelValue))},r.hasError=function(){return i.$invalid&&!i.$pristine},r.schemaError=function(){return a}}}}]);